import { memo } from 'react';
import type { Theme } from '@/hooks/useGame2048';

interface GameTileProps {
  value: number;
  size: number;
  theme: Theme;
  isNew: boolean;
  isMerged: boolean;
}

const baseTileStyles: Record<number, { bg: string; text: string }> = {
  0: { bg: '#cdc1b4', text: '#776e65' },
  2: { bg: '#eee4da', text: '#776e65' },
  4: { bg: '#ede0c8', text: '#776e65' },
  8: { bg: '#f2b179', text: '#f9f6f2' },
  16: { bg: '#f59563', text: '#f9f6f2' },
  32: { bg: '#f67c5f', text: '#f9f6f2' },
  64: { bg: '#f65e3b', text: '#f9f6f2' },
  128: { bg: '#edcf72', text: '#f9f6f2' },
  256: { bg: '#edcc61', text: '#f9f6f2' },
  512: { bg: '#edc850', text: '#f9f6f2' },
  1024: { bg: '#edc53f', text: '#f9f6f2' },
  2048: { bg: '#edc22e', text: '#f9f6f2' },
  4096: { bg: '#3c3a32', text: '#f9f6f2' },
};

const themeStyles: Record<Theme, Record<number, { bg: string; text: string }>> = {
  classic: baseTileStyles,
  blue: {
    0: { bg: '#8dc8ea', text: '#5babe9' },
    2: { bg: '#9cbde9', text: '#0a3854' },
    4: { bg: '#6591ca', text: '#0a3854' },
    8: { bg: '#0567e8', text: '#bee2f8' },
    16: { bg: '#05469b', text: '#bee2f8' },
    32: { bg: '#033b83', text: '#bee2f8' },
    64: { bg: '#03224b', text: '#bee2f8' },
    128: { bg: '#5906d6', text: '#bee2f8' },
    256: { bg: '#9308e3', text: '#bee2f8' },
    512: { bg: '#e107e8', text: '#2e0049' },
    1024: { bg: '#9e0570', text: '#bee2f8' },
    2048: { bg: '#0c0059', text: '#bee2f8' },
    4096: { bg: '#0c0059', text: '#bee2f8' },
  },
  fire: {
    0: { bg: '#ffc18f', text: '#776e65' },
    2: { bg: '#ffc7c7', text: '#510303' },
    4: { bg: '#ffa1a1', text: '#510303' },
    8: { bg: '#ff7b00', text: '#f9f6f2' },
    16: { bg: '#ffa600', text: '#f9f6f2' },
    32: { bg: '#ffd500', text: '#1a1a1a' },
    64: { bg: '#f2ff00', text: '#1a1a1a' },
    128: { bg: '#ff0000', text: '#f9f6f2' },
    256: { bg: '#bd0000', text: '#f9f6f2' },
    512: { bg: '#bf4600', text: '#f9f6f2' },
    1024: { bg: '#8a003e', text: '#f9f6f2' },
    2048: { bg: '#000000', text: '#f9f6f2' },
    4096: { bg: '#000000', text: '#f9f6f2' },
  },
  bubblegum: {
    0: { bg: '#ffb3d9', text: '#fff' },
    2: { bg: '#ffe0f0', text: '#000' },
    4: { bg: '#ffc0e0', text: '#000' },
    8: { bg: '#ff99cc', text: '#fff' },
    16: { bg: '#ff66b2', text: '#fff' },
    32: { bg: '#ff3385', text: '#fff' },
    64: { bg: '#ff007f', text: '#fff' },
    128: { bg: '#e60073', text: '#fff' },
    256: { bg: '#cc0066', text: '#fff' },
    512: { bg: '#b30059', text: '#fff' },
    1024: { bg: '#99004d', text: '#fff' },
    2048: { bg: '#660033', text: '#fff' },
    4096: { bg: '#660033', text: '#fff' },
  },
  dark: {
    0: { bg: '#555', text: '#fff' },
    2: { bg: '#666', text: '#fff' },
    4: { bg: '#777', text: '#fff' },
    8: { bg: '#888', text: '#fff' },
    16: { bg: '#999', text: '#fff' },
    32: { bg: '#aaa', text: '#fff' },
    64: { bg: '#bbb', text: '#fff' },
    128: { bg: '#ccc', text: '#000' },
    256: { bg: '#ddd', text: '#000' },
    512: { bg: '#eee', text: '#000' },
    1024: { bg: '#fff', text: '#000' },
    2048: { bg: '#000', text: '#fff' },
    4096: { bg: '#000', text: '#fff' },
  },
  forest: {
    0: { bg: '#a8d5a2', text: '#2d5a27' },
    2: { bg: '#c8e6c9', text: '#1b5e20' },
    4: { bg: '#a5d6a7', text: '#1b5e20' },
    8: { bg: '#81c784', text: '#ffffff' },
    16: { bg: '#66bb6a', text: '#ffffff' },
    32: { bg: '#4caf50', text: '#ffffff' },
    64: { bg: '#43a047', text: '#ffffff' },
    128: { bg: '#388e3c', text: '#ffffff' },
    256: { bg: '#2e7d32', text: '#ffffff' },
    512: { bg: '#1b5e20', text: '#ffffff' },
    1024: { bg: '#0d3d12', text: '#ffffff' },
    2048: { bg: '#052e0a', text: '#a5d6a7' },
    4096: { bg: '#021f06', text: '#a5d6a7' },
  },
  sunset: {
    0: { bg: '#ffd4a8', text: '#8b4513' },
    2: { bg: '#ffe4c4', text: '#8b4513' },
    4: { bg: '#ffc89c', text: '#8b4513' },
    8: { bg: '#ffb366', text: '#ffffff' },
    16: { bg: '#ff9933', text: '#ffffff' },
    32: { bg: '#ff8000', text: '#ffffff' },
    64: { bg: '#ff6600', text: '#ffffff' },
    128: { bg: '#e64d00', text: '#ffffff' },
    256: { bg: '#cc3300', text: '#ffffff' },
    512: { bg: '#b31a00', text: '#ffffff' },
    1024: { bg: '#990000', text: '#ffffff' },
    2048: { bg: '#660033', text: '#ffcccc' },
    4096: { bg: '#330019', text: '#ffcccc' },
  },
  lavender: {
    0: { bg: '#e6e6fa', text: '#4b0082' },
    2: { bg: '#f0e6ff', text: '#4b0082' },
    4: { bg: '#dcd0ff', text: '#4b0082' },
    8: { bg: '#c8a8ff', text: '#ffffff' },
    16: { bg: '#b380ff', text: '#ffffff' },
    32: { bg: '#9f5aff', text: '#ffffff' },
    64: { bg: '#8a2be2', text: '#ffffff' },
    128: { bg: '#7b1fa2', text: '#ffffff' },
    256: { bg: '#6a1b9a', text: '#ffffff' },
    512: { bg: '#4a148c', text: '#ffffff' },
    1024: { bg: '#311b92', text: '#ffffff' },
    2048: { bg: '#1a0a4b', text: '#e6e6fa' },
    4096: { bg: '#0d0526', text: '#e6e6fa' },
  },
  mint: {
    0: { bg: '#b2f5ea', text: '#047857' },
    2: { bg: '#c6f7e2', text: '#047857' },
    4: { bg: '#8eedc7', text: '#047857' },
    8: { bg: '#5ed5a8', text: '#ffffff' },
    16: { bg: '#3eb489', text: '#ffffff' },
    32: { bg: '#2dd4bf', text: '#ffffff' },
    64: { bg: '#14b8a6', text: '#ffffff' },
    128: { bg: '#0d9488', text: '#ffffff' },
    256: { bg: '#0f766e', text: '#ffffff' },
    512: { bg: '#115e59', text: '#ffffff' },
    1024: { bg: '#134e4a', text: '#ffffff' },
    2048: { bg: '#042f2e', text: '#b2f5ea' },
    4096: { bg: '#021a1a', text: '#b2f5ea' },
  },
  neon: {
    0: { bg: '#1a1a2e', text: '#00ffff' },
    2: { bg: '#16213e', text: '#00ffff' },
    4: { bg: '#0f3460', text: '#ff00ff' },
    8: { bg: '#ff00ff', text: '#000000' },
    16: { bg: '#00ffff', text: '#000000' },
    32: { bg: '#39ff14', text: '#000000' },
    64: { bg: '#ff073a', text: '#ffffff' },
    128: { bg: '#ffff00', text: '#000000' },
    256: { bg: '#ff6600', text: '#000000' },
    512: { bg: '#bf00ff', text: '#ffffff' },
    1024: { bg: '#ff1493', text: '#ffffff' },
    2048: { bg: '#ffffff', text: '#000000' },
    4096: { bg: '#000000', text: '#00ffff' },
  },
  aurora: {
    0: { bg: '#1a3a4a', text: '#7fdbda' },
    2: { bg: '#1e4d5c', text: '#7fdbda' },
    4: { bg: '#2d6b7a', text: '#ffffff' },
    8: { bg: '#3eb489', text: '#ffffff' },
    16: { bg: '#2ecc71', text: '#ffffff' },
    32: { bg: '#1abc9c', text: '#ffffff' },
    64: { bg: '#3498db', text: '#ffffff' },
    128: { bg: '#9b59b6', text: '#ffffff' },
    256: { bg: '#8e44ad', text: '#ffffff' },
    512: { bg: '#e74c3c', text: '#ffffff' },
    1024: { bg: '#f39c12', text: '#ffffff' },
    2048: { bg: '#ffffff', text: '#1a3a4a' },
    4096: { bg: '#0d1f27', text: '#7fdbda' },
  },
  cherry: {
    0: { bg: '#fce4ec', text: '#c2185b' },
    2: { bg: '#f8bbd9', text: '#880e4f' },
    4: { bg: '#f48fb1', text: '#880e4f' },
    8: { bg: '#f06292', text: '#ffffff' },
    16: { bg: '#ec407a', text: '#ffffff' },
    32: { bg: '#e91e63', text: '#ffffff' },
    64: { bg: '#d81b60', text: '#ffffff' },
    128: { bg: '#c2185b', text: '#ffffff' },
    256: { bg: '#ad1457', text: '#ffffff' },
    512: { bg: '#880e4f', text: '#ffffff' },
    1024: { bg: '#6d0a3e', text: '#ffffff' },
    2048: { bg: '#4a0729', text: '#fce4ec' },
    4096: { bg: '#2d0418', text: '#fce4ec' },
  },
  gold: {
    0: { bg: '#fff8dc', text: '#b8860b' },
    2: { bg: '#ffefd5', text: '#b8860b' },
    4: { bg: '#ffe4b5', text: '#b8860b' },
    8: { bg: '#ffd700', text: '#1a1a1a' },
    16: { bg: '#ffc125', text: '#1a1a1a' },
    32: { bg: '#ffb90f', text: '#1a1a1a' },
    64: { bg: '#daa520', text: '#ffffff' },
    128: { bg: '#cd950c', text: '#ffffff' },
    256: { bg: '#b8860b', text: '#ffffff' },
    512: { bg: '#a67c00', text: '#ffffff' },
    1024: { bg: '#8b7500', text: '#ffffff' },
    2048: { bg: '#6b5900', text: '#ffd700' },
    4096: { bg: '#4a3d00', text: '#ffd700' },
  },
  galaxy: {
    0: { bg: '#1a1a3e', text: '#9090d0' },
    2: { bg: '#2d2d5e', text: '#c0c0ff' },
    4: { bg: '#3d3d7e', text: '#e0e0ff' },
    8: { bg: '#5a3d9e', text: '#ffffff' },
    16: { bg: '#7b2d9e', text: '#ffffff' },
    32: { bg: '#9c27b0', text: '#ffffff' },
    64: { bg: '#ab47bc', text: '#ffffff' },
    128: { bg: '#ce93d8', text: '#1a1a3e' },
    256: { bg: '#e1bee7', text: '#1a1a3e' },
    512: { bg: '#ff80ab', text: '#1a1a3e' },
    1024: { bg: '#ff4081', text: '#ffffff' },
    2048: { bg: '#ffffff', text: '#1a1a3e' },
    4096: { bg: '#0a0a1e', text: '#ce93d8' },
  },
  rainbow: {
    0: { bg: '#f0f0f0', text: '#333333' },
    2: { bg: '#ff6b6b', text: '#ffffff' },
    4: { bg: '#ffa94d', text: '#ffffff' },
    8: { bg: '#ffd43b', text: '#1a1a1a' },
    16: { bg: '#69db7c', text: '#1a1a1a' },
    32: { bg: '#4dabf7', text: '#ffffff' },
    64: { bg: '#748ffc', text: '#ffffff' },
    128: { bg: '#da77f2', text: '#ffffff' },
    256: { bg: '#f783ac', text: '#ffffff' },
    512: { bg: '#ff6b6b', text: '#ffffff' },
    1024: { bg: '#ffa94d', text: '#1a1a1a' },
    2048: { bg: '#ffffff', text: '#333333' },
    4096: { bg: '#1a1a1a', text: '#ffffff' },
  },
  diamond: {
    0: { bg: '#e0ffff', text: '#4682b4' },
    2: { bg: '#f0ffff', text: '#4682b4' },
    4: { bg: '#e6ffff', text: '#4682b4' },
    8: { bg: '#b9f2ff', text: '#1a5276' },
    16: { bg: '#87ceeb', text: '#1a5276' },
    32: { bg: '#7ec8e3', text: '#ffffff' },
    64: { bg: '#00bfff', text: '#ffffff' },
    128: { bg: '#00a6d6', text: '#ffffff' },
    256: { bg: '#0077be', text: '#ffffff' },
    512: { bg: '#005b96', text: '#ffffff' },
    1024: { bg: '#003d6b', text: '#ffffff' },
    2048: { bg: '#ffffff', text: '#003d6b' },
    4096: { bg: '#001f3d', text: '#b9f2ff' },
  },
};

const gridColors: Record<Theme, string> = {
  classic: '#bbada0',
  blue: '#5babe9',
  fire: '#ff9c4b',
  bubblegum: '#ffd6eb',
  dark: '#333',
  forest: '#4a7c4e',
  sunset: '#ff9966',
  lavender: '#b39ddb',
  mint: '#80cbc4',
  neon: '#2d2d5e',
  aurora: '#1e4d5c',
  cherry: '#f8bbd9',
  gold: '#daa520',
  galaxy: '#2d2d5e',
  rainbow: '#e0e0e0',
  diamond: '#a8dadc',
};

export const getGridColor = (theme: Theme) => gridColors[theme];

export const GameTile = memo(({ value, size, theme, isNew, isMerged }: GameTileProps) => {
  const styles = themeStyles[theme][value] || themeStyles[theme][4096];
  const fontSize = Math.max(12, Math.floor(size * 0.38));
  
  const animationClass = isNew ? 'animate-spawn' : isMerged ? 'animate-pop' : '';

  return (
    <div
      className={`game-cell ${animationClass}`}
      style={{
        width: size,
        height: size,
        backgroundColor: styles.bg,
        color: styles.text,
        fontSize: value > 512 ? fontSize * 0.8 : fontSize,
      }}
    >
      {value > 0 && value}
    </div>
  );
});

GameTile.displayName = 'GameTile';
